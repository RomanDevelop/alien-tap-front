<!DOCTYPE html>
<html>
<head>
  <title>Test Telegram Mock</title>
</head>
<body>
  <h1>Telegram Mock Test</h1>
  <div id="output"></div>
  
  <script>
    const output = document.getElementById('output');
    
    function log(message) {
      console.log(message);
      const p = document.createElement('p');
      p.textContent = message;
      output.appendChild(p);
    }
    
    log('ğŸ” Starting test...');
    
    // Step 1: Initialize structure
    window.Telegram = window.Telegram || {};
    window.Telegram.WebApp = window.Telegram.WebApp || {};
    log('âœ… Step 1: Telegram.WebApp structure initialized');
    
    // Step 2: Load telegram-web-app.js
    const script1 = document.createElement('script');
    script1.src = 'https://telegram.org/js/telegram-web-app.js';
    script1.onload = function() {
      log('âœ… Step 2: telegram-web-app.js loaded');
      
      // Step 3: Load telegram.js
      const script2 = document.createElement('script');
      script2.src = 'telegram.js';
      script2.onload = function() {
        log('âœ… Step 3: telegram.js loaded');
        
        // Step 4: Check mock
        setTimeout(() => {
          log('ğŸ” Step 4: Checking mock...');
          
          if (window.Telegram && window.Telegram.WebApp) {
            log('âœ… Telegram.WebApp exists');
            
            if (window.Telegram.WebApp.initDataUnsafe) {
              const mock = window.Telegram.WebApp.initDataUnsafe;
              log('âœ… initDataUnsafe exists');
              log(`ğŸ“‹ hash: ${mock.hash}`);
              log(`ğŸ“‹ hash type: ${typeof mock.hash}`);
              log(`ğŸ“‹ hash length: ${mock.hash?.length || 0}`);
              log(`ğŸ“‹ auth_date: ${mock.auth_date}`);
              log(`ğŸ“‹ user: ${JSON.stringify(mock.user)}`);
              
              // Test getInitDataProperty
              if (window.Telegram.WebApp.getInitDataProperty) {
                const hash = window.Telegram.WebApp.getInitDataProperty('hash');
                log(`ğŸ§ª getInitDataProperty('hash'): ${hash}`);
              } else {
                log('âŒ getInitDataProperty function not found');
              }
              
              // Test ensureTelegramMock
              if (typeof window.ensureTelegramMock === 'function') {
                log('âœ… ensureTelegramMock function exists');
                const result = window.ensureTelegramMock();
                log(`ğŸ§ª ensureTelegramMock() returned: ${result ? 'object' : 'null'}`);
              } else {
                log('âŒ ensureTelegramMock function not found');
              }
            } else {
              log('âŒ initDataUnsafe is null/undefined');
              log('ğŸ’¡ Trying to call ensureTelegramMock()...');
              if (typeof window.ensureTelegramMock === 'function') {
                window.ensureTelegramMock();
                if (window.Telegram.WebApp.initDataUnsafe) {
                  log('âœ… Mock created after ensureTelegramMock()');
                } else {
                  log('âŒ Mock still not created after ensureTelegramMock()');
                }
              }
            }
          } else {
            log('âŒ Telegram.WebApp does not exist');
          }
        }, 500);
      };
      script2.onerror = function() {
        log('âŒ Failed to load telegram.js');
      };
      document.head.appendChild(script2);
    };
    script1.onerror = function() {
      log('âŒ Failed to load telegram-web-app.js');
    };
    document.head.appendChild(script1);
  </script>
</body>
</html>

